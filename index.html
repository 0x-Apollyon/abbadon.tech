<html>
    <head>
        <title>Abbadon: The home of Apollyon</title>
        <link rel="icon" type="image/x-icon" href="./icon.ico">
        
        <style>
            * { scrollbar-width: thin; scrollbar-color: #333 #000; }
            ::-webkit-scrollbar { width: 6px; }
            ::-webkit-scrollbar-track { background: #050505; }
            ::-webkit-scrollbar-thumb { background-color: #333; border-radius: 3px; }
            ::-webkit-scrollbar-thumb:hover { background-color: #555; }

            body {
                background-color: black;
                color: white;
                margin: 0;
                overflow-y: auto; 
                height: 100vh;
                width: 100vw;
                display: flex;
                flex-direction: column;
                font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            }

            #canvas-container {
                flex-grow: 1;
                width: 100%;
                min-height: 500px; 
                position: relative;
                display: flex;
                justify-content: center;
                align-items: center;
                background-color: #050505;
                cursor: default; 
                touch-action: none; 
            }

            canvas {
                display: block;
                image-rendering: pixelated; 
            }

            .nav-container {
                height: 70px;
                min-height: 70px;
                display: flex;
                justify-content: space-between; 
                align-items: center;
                background-color: black;
                z-index: 10;
                flex-shrink: 0; 
                margin: 0 auto; 
                border-top: 1px solid #111; 
                box-sizing: border-box;
                width: 0; 
                opacity: 0; 
                transition: opacity 0.3s ease;
            }

            .nav-link {
                font-size: 11px;
                letter-spacing: 1.5px;
                font-weight: 500;
                color: #666;
                text-decoration: none;
                text-transform: uppercase;
                transition: color 0.3s ease;
                padding: 10px 0; 
                white-space: nowrap; 
            }

            .nav-link:hover { color: #FFF; }
        </style>
    </head>
    <body>

        <div id="canvas-container">
            <canvas id="ascii-canvas"></canvas>
        </div>

        <div class="nav-container">
            <a href="./blog/index.html" class="nav-link">Blog & Research</a>
            <a href="./projects/index.html" class="nav-link">Projects</a>
            <a href="./contact/index.html" class="nav-link">Contact</a>
        </div>

<script src="./ascii_data.js"></script>

<script>
    const canvas = document.getElementById('ascii-canvas');
    const ctx = canvas.getContext('2d');
    const container = document.getElementById('canvas-container');
    const navContainer = document.querySelector('.nav-container');

    let flashlightRadius = 150;
    let mouse = { x: -1000, y: -1000 };
    let isColorLocked = false;
    let currentDrawBounds = { x:0, y:0, w:0, h:0 }; 

    handleResize();
    window.requestAnimationFrame(loop);

    function handleResize() {
        const w = container.clientWidth;
        const h = container.clientHeight;
        
        if (w === 0 || h === 0) return;

        canvas.width = w;
        canvas.height = h;

        flashlightRadius = Math.min(w, h) * 0.15;
        if (flashlightRadius < 80) flashlightRadius = 80;

        const screenAspect = w / h;
        let drawW, drawH;

        const aspect = (typeof IMG_ASPECT_RATIO !== 'undefined') ? IMG_ASPECT_RATIO : 1;

        if (aspect > screenAspect) {
            drawW = w;
            drawH = w / aspect;
        } else {
            drawH = h;
            drawW = h * aspect;
        }

        const offX = (w - drawW) / 2;
        const offY = (h - drawH) / 2;

        currentDrawBounds = { x: offX, y: offY, w: drawW, h: drawH };

        navContainer.style.width = `${drawW}px`;
        navContainer.style.opacity = '1';

        ctx.font = 'bold ' + (drawW / 100) + 'px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace';
        ctx.textBaseline = 'top';
    }

    function loop() {
        ctx.fillStyle = 'black';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        const radSq = flashlightRadius * flashlightRadius;
        
        if (typeof PRECOMPUTED_DATA !== 'undefined') {
            const len = PRECOMPUTED_DATA.length;
            
            for (let i = 0; i < len; i++) {
                const p = PRECOMPUTED_DATA[i];
                
                const u = p[0];
                const v = p[1];
                const char = p[2];
                
                const px = currentDrawBounds.x + (u * currentDrawBounds.w);
                const py = currentDrawBounds.y + (v * currentDrawBounds.h);

                if (isColorLocked) {
                    ctx.fillStyle = `rgb(${p[3]},${p[4]},${p[5]})`;
                } else {
                    const dx = px - mouse.x;
                    const dy = py - mouse.y;
                    
                    if ((dx*dx + dy*dy) < radSq) {
                        ctx.fillStyle = `rgb(${p[3]},${p[4]},${p[5]})`;
                    } else {
                        ctx.fillStyle = '#222'; 
                    }
                }
                ctx.fillText(char, px, py);
            }
        }

        requestAnimationFrame(loop);
    }

    function updateMouse(clientX, clientY) {
        const rect = canvas.getBoundingClientRect();
        const lx = clientX - rect.left;
        const ly = clientY - rect.top;
        mouse.x = lx;
        mouse.y = ly;

        const inside = lx >= currentDrawBounds.x && lx <= currentDrawBounds.x + currentDrawBounds.w &&
                       ly >= currentDrawBounds.y && ly <= currentDrawBounds.y + currentDrawBounds.h;
        
        container.style.cursor = inside ? 'pointer' : 'default';
        return inside;
    }

    container.addEventListener('mousemove', e => updateMouse(e.clientX, e.clientY));
    
    container.addEventListener('click', e => {
        if (updateMouse(e.clientX, e.clientY)) {
            isColorLocked = !isColorLocked;
        }
    });

    container.addEventListener('mouseleave', () => {
        mouse.x = -1000;
        mouse.y = -1000;
        container.style.cursor = 'default';
    });

    container.addEventListener('touchstart', e => updateMouse(e.touches[0].clientX, e.touches[0].clientY), {passive: true});
    container.addEventListener('touchmove', e => updateMouse(e.touches[0].clientX, e.touches[0].clientY), {passive: true});

    window.addEventListener('resize', handleResize);


    
    const originalTitle = document.title;
    let faviconLink = document.querySelector("link[rel~='icon']");
    
    if (!faviconLink) {
        faviconLink = document.createElement('link');
        faviconLink.rel = 'icon';
        document.head.appendChild(faviconLink);
    }
    
    const originalFavicon = faviconLink.href;

    const tabDisguises = [
        { title: "Inbox (13) - Gmail", favicon: "gmail_favicon.png" },
        { title: "GitHub", favicon: "github_icon.png" },
        { title: "(2) Discord | Friends", favicon: "discord_icon.png" },
        { title: "Home / X", favicon: "x_favicon.png" },
        { title: "ChatGPT", favicon: "chatgpt_favicon.png" },
        { title: "Claude", favicon: "claude_icon.png" },
        { title: "Welcome to fbi.gov - FBI", favicon: "fbi_favicon.png" },
        { title: "We are the nations first line of defense - CIA", favicon: "cia_favicon.png" }
    ];

    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            const random = tabDisguises[Math.floor(Math.random() * tabDisguises.length)];
            document.title = random.title;
            faviconLink.href = random.favicon;
        } else {
            document.title = originalTitle;
            faviconLink.href = originalFavicon;
        }
    });

</script>
</body>
</html>