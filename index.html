<html>
    <head>
        <title>Abbadon: The home of Apollyon</title>
        <link rel="icon" type="image/x-icon" href="./icon.ico">
        
        <style>
            /* --- SCROLLBAR STYLING --- */
            * {
                scrollbar-width: thin;
                scrollbar-color: #333 #000;
            }

            ::-webkit-scrollbar {
                width: 6px;
            }

            ::-webkit-scrollbar-track {
                background: #050505;
            }

            ::-webkit-scrollbar-thumb {
                background-color: #333;
                border-radius: 3px;
            }

            ::-webkit-scrollbar-thumb:hover {
                background-color: #555;
            }

            /* --- CORE LAYOUT --- */
            body {
                background-color: black;
                color: white;
                margin: 0;
                overflow-y: auto; 
                height: 100vh;
                width: 100vw;
                display: flex;
                flex-direction: column;
                font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            }

            /* --- THE MAIN STAGE --- */
            #canvas-container {
                flex-grow: 1;
                width: 100%;
                min-height: 500px; 
                position: relative;
                display: flex;
                justify-content: center;
                align-items: center;
                background-color: #050505;
                cursor: default; 
                touch-action: none; 
            }

            canvas {
                display: block;
                image-rendering: pixelated; 
                -webkit-font-smoothing: none;
            }

            /* --- NAVIGATION LINKS (Bottom) --- */
            .nav-container {
                height: 70px;
                min-height: 70px;
                display: flex;
                /* CHANGED: This pushes items to the far left, center, and far right */
                justify-content: space-between; 
                align-items: center;
                background-color: black;
                z-index: 10;
                flex-shrink: 0; 
                /* We remove padding here because we will set a strict width in JS */
                margin: 0 auto; /* Centers the container itself */
                border-top: 1px solid #111; 
                box-sizing: border-box;
            }

            .nav-link {
                font-size: 11px;
                letter-spacing: 1.5px;
                font-weight: 500;
                color: #666; /* Slightly darker default for more contrast on hover */
                text-decoration: none;
                text-transform: uppercase;
                transition: color 0.3s ease;
                padding: 10px 0; /* Remove side padding to align perfectly with edge */
                white-space: nowrap; 
            }

            .nav-link:hover {
                color: #FFF; 
            }

            /* Loading Message */
            #loading {
                position: absolute;
                color: #444;
                font-size: 11px;
                letter-spacing: 2px;
                pointer-events: none;
                text-transform: uppercase;
                animation: pulse 2s infinite;
            }

            @keyframes pulse {
                0% { opacity: 0.4; }
                50% { opacity: 0.8; }
                100% { opacity: 0.4; }
            }

            /* --- MOBILE RESPONSIVENESS --- */
            @media (max-width: 600px) {
                .nav-link {
                    font-size: 9px;
                    letter-spacing: 0.5px;
                }
            }
        </style>
    </head>
    <body>

        <!-- THE MAIN ASCII ART CANVAS -->
        <div id="canvas-container">
            <div id="loading">Initializing System...</div>
            <canvas id="ascii-canvas"></canvas>
        </div>

        <!-- THE NAVIGATION LINKS -->
        <div class="nav-container">
            <!-- Note: justify-content: space-between puts this on the far left -->
            <a href="./blog/index.html" class="nav-link">Blog & Research</a>
            
            <!-- This stays in the center -->
            <a href="./projects/index.html" class="nav-link">Projects</a>
            
            <!-- This goes to the far right -->
            <a href="./contact/index.html" class="nav-link">Contact</a>
        </div>

<script>
    /**
     * CONFIGURATION
     */
    const canvas = document.getElementById('ascii-canvas');
    const ctx = canvas.getContext('2d');
    const loadingText = document.getElementById('loading');
    const container = document.getElementById('canvas-container');
    // We need the nav container to manipulate its width
    const navContainer = document.querySelector('.nav-container');
    
    const density = '@#W$9876543210?!abc;:+=-,._                    '; 
    
    let fontSize = 10;
    let flashlightRadius = 150;
    
    let imageCoordinates = [];
    let imgBounds = { x: 0, y: 0, w: 0, h: 0 };
    
    let mouse = { x: -1000, y: -1000 };
    let isColorLocked = false;
    let resizeTimeout;

    const image = new Image();
    image.src = "./girl_with_pearl.jpg";

    image.onload = function() {
        loadingText.style.display = 'none';
        initAscii();
    };


    function handleInteraction(clientX, clientY) {
        const rect = canvas.getBoundingClientRect();
        const localX = clientX - rect.left;
        const localY = clientY - rect.top;
        
        mouse.x = localX;
        mouse.y = localY;

        //cursor feedback
        if (localX >= imgBounds.x && localX <= imgBounds.x + imgBounds.w &&
            localY >= imgBounds.y && localY <= imgBounds.y + imgBounds.h) {
            container.style.cursor = 'pointer';
        } else {
            container.style.cursor = 'default';
        }
        
        return { x: localX, y: localY };
    }

    container.addEventListener('mousemove', function(e) {
        handleInteraction(e.clientX, e.clientY);
    });

    container.addEventListener('click', function(e) {
        const pos = handleInteraction(e.clientX, e.clientY);
        
        //click only in image area
        if (pos.x >= imgBounds.x && pos.x <= imgBounds.x + imgBounds.w &&
            pos.y >= imgBounds.y && pos.y <= imgBounds.y + imgBounds.h) {
            isColorLocked = !isColorLocked;
        }
    });

    container.addEventListener('mouseleave', function() {
        mouse.x = -1000;
        mouse.y = -1000;
        container.style.cursor = 'default';
    });

    container.addEventListener('touchstart', function(e) {
        const touch = e.touches[0];
        handleInteraction(touch.clientX, touch.clientY);
    }, {passive: true});

    container.addEventListener('touchmove', function(e) {
        const touch = e.touches[0];
        handleInteraction(touch.clientX, touch.clientY);
    }, {passive: true});


    //core

    function initAscii() {
        const w = container.clientWidth;
        const h = container.clientHeight;
        canvas.width = w;
        canvas.height = h;

        const targetColumns = 110; 
        fontSize = Math.floor(w / targetColumns);
        if (fontSize < 6) fontSize = 6;
        if (fontSize > 14) fontSize = 14; 

        flashlightRadius = Math.min(w, h) * 0.15;
        if (flashlightRadius < 80) flashlightRadius = 80;

        const aspectImg = image.width / image.height;
        const aspectCan = w / h;
        
        let drawWidth, drawHeight;

        if (aspectImg > aspectCan) {
            drawWidth = w;
            drawHeight = w / aspectImg;
        } else {
            drawHeight = h;
            drawWidth = h * aspectImg;
        }


        navContainer.style.width = `${drawWidth}px`;

        const offCanvas = document.createElement('canvas');
        const offCtx = offCanvas.getContext('2d');
        
        const cols = Math.floor(drawWidth / fontSize);
        const rows = Math.floor(drawHeight / fontSize);

        offCanvas.width = cols;
        offCanvas.height = rows;

        offCtx.drawImage(image, 0, 0, cols, rows);
        const imageData = offCtx.getImageData(0, 0, cols, rows).data;

        imageCoordinates = [];

        const offsetX = (w - (cols * fontSize)) / 2;
        const offsetY = (h - (rows * fontSize)) / 2;

        imgBounds = {
            x: offsetX,
            y: offsetY,
            w: cols * fontSize,
            h: rows * fontSize
        };

        for (let y = 0; y < rows; y++) {
            for (let x = 0; x < cols; x++) {
                const index = (y * cols + x) * 4;
                const r = imageData[index];
                const g = imageData[index + 1];
                const b = imageData[index + 2];
                const a = imageData[index + 3];

                if (a > 120) { 
                    const brightness = (r + g + b) / 3;
                    const charIndex = Math.floor(map(brightness, 0, 255, density.length - 1, 0));
                    const char = density.charAt(charIndex);

                    imageCoordinates.push({
                        x: x * fontSize + offsetX,
                        y: y * fontSize + offsetY,
                        char: char,
                        color: `rgb(${r},${g},${b})`
                    });
                }
            }
        }

        if (!window.animationRunning) {
            window.animationRunning = true;
            animate();
        }
    }

    function animate() {
        ctx.fillStyle = 'black';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.font = 'bold ' + fontSize + 'px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace';
        ctx.textBaseline = 'top';

        for (let i = 0; i < imageCoordinates.length; i++) {
            const point = imageCoordinates[i];

            if (isColorLocked) {
                ctx.fillStyle = point.color;
            } else {
                const dx = point.x - mouse.x;
                const dy = point.y - mouse.y;
                const distSq = dx*dx + dy*dy;
                const radSq = flashlightRadius * flashlightRadius;

                if (distSq < radSq) {
                    ctx.fillStyle = point.color;
                } else {
                    ctx.fillStyle = '#222'; 
                }
            }

            ctx.fillText(point.char, point.x, point.y);
        }

        requestAnimationFrame(animate);
    }

    function map(value, start1, stop1, start2, stop2) {
        return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
    }

    window.addEventListener('resize', function() {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(function() {
            initAscii();
        }, 150);
    });

</script>

<script>
    const originalTitle = document.title;
    const originalFavicon = document.querySelector("link[rel='icon']").href;

    const tabDisguises = [
        {
            title: "Inbox (13) - Gmail",
            favicon: "gmail_favicon.png"
        },
        {
            title: "GitHub",
            favicon: "github_icon.png"
        },
        {
            title: "(2) Discord | Friends",
            favicon: "discord_icon.png"
        },
        {
            title: "Home / X",
            favicon: "x_favicon.png"
        },
        {
            title: "ChatGPT",
            favicon: "chatgpt_favicon.png"
        },
        {
            title: "Claude",
            favicon: "claude_icon.png"
        },
        {
            title: "Welcome to fbi.gov - FBI",
            favicon: "fbi_favicon.png"
        },
        {
            title: "We are the nations first line of defense - CIA",
            favicon: "cia_favicon.png"
        }
    ];

    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            const randomIndex = Math.floor(Math.random() * tabDisguises.length);
            const selectedDisguise = tabDisguises[randomIndex];
            
            document.title = selectedDisguise.title;
            
            const currentFavicon = document.querySelector("link[rel='icon']");
            if (currentFavicon) {
                document.head.removeChild(currentFavicon);
            }
            
            const newFavicon = document.createElement('link');
            newFavicon.rel = 'icon';
            newFavicon.type = 'image/x-icon';
            newFavicon.href = selectedDisguise.favicon;
            document.head.appendChild(newFavicon);
        } else {
            document.title = originalTitle;
            
            const currentFavicon = document.querySelector("link[rel='icon']");
            if (currentFavicon) {
                document.head.removeChild(currentFavicon);
            }
            
            const restoreFavicon = document.createElement('link');
            restoreFavicon.rel = 'icon';
            restoreFavicon.type = 'image/x-icon';
            restoreFavicon.href = originalFavicon;
            document.head.appendChild(restoreFavicon);
        }
    });
</script>
</body>
</html>